###
# API Examples - Terrenos SaaS Backend
# Usa la extensión REST Client de VS Code
###

@baseUrl = http://localhost:8080
@contentType = application/json

### Variables (se actualizan después de cada request)
@accessToken =
@refreshToken =
@tenantId = 1
@usuarioId = 1

# ==========================================
# HEALTH CHECK
# ==========================================

### Health Check
GET {{baseUrl}}/actuator/health
Accept: application/json

### API Info
GET {{baseUrl}}/actuator/info
Accept: application/json

# ==========================================
# AUTHENTICATION
# ==========================================

### 1. Registrar Nueva Empresa (Tenant) con Usuario Admin
# IMPORTANTE: Ejecuta esto primero para crear una empresa y obtener tokens
# @name register
POST {{baseUrl}}/api/v1/auth/register
Content-Type: {{contentType}}

{
  "nombreEmpresa": "Inmobiliaria Los Pinos",
  "emailEmpresa": "contacto@inmobiliaria-pinos.com",
  "telefonoEmpresa": "5551234567",
  "direccionEmpresa": "Av. Reforma 123, CDMX",
  "razonSocial": "Inmobiliaria Los Pinos S.A. de C.V.",
  "rfc": "ILP230101ABC",
  "nombre": "Carlos",
  "apellido": "Mendoza",
  "email": "carlos.mendoza@inmobiliaria-pinos.com",
  "password": "Admin123!",
  "telefono": "5559876543"
}

# Respuesta esperada:
# {
#   "accessToken": "eyJhbGciOiJIUzI1NiIsInR5...",
#   "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5...",
#   "tokenType": "Bearer",
#   "expiresIn": 86400000,
#   "userInfo": {
#     "id": 1,
#     "nombre": "Carlos Mendoza",
#     "email": "carlos.mendoza@inmobiliaria-pinos.com",
#     "tenantId": 1,
#     "tenantNombre": "Inmobiliaria Los Pinos"
#   }
# }

### 2. Login (obtener token JWT)
# Usa las credenciales del usuario creado en el registro
# @name login
POST {{baseUrl}}/api/v1/auth/login
Content-Type: {{contentType}}

{
  "email": "carlos.mendoza@inmobiliaria-pinos.com",
  "password": "Admin123!"
}

### 3. Refresh Token
# Usa el refreshToken obtenido del login o registro
# @name refresh
POST {{baseUrl}}/api/v1/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{refreshToken}}"
}

# ==========================================
# TENANTS
# ==========================================

### Obtener información del Tenant actual
GET {{baseUrl}}/api/v1/tenants/me
Authorization: Bearer {{accessToken}}

### Actualizar Tenant
PUT {{baseUrl}}/api/v1/tenants/{{tenantId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "nombre": "Inmobiliaria Demo (Actualizada)",
  "telefono": "5559876543"
}

# ==========================================
# USUARIOS
# ==========================================

### Listar todos los usuarios del tenant
GET {{baseUrl}}/api/v1/usuarios
Authorization: Bearer {{accessToken}}

### Obtener usuario por ID
GET {{baseUrl}}/api/v1/usuarios/{{usuarioId}}
Authorization: Bearer {{accessToken}}

### Crear nuevo usuario
# @name createUsuario
POST {{baseUrl}}/api/v1/usuarios
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "nombre": "Juan",
  "apellido": "Pérez",
  "email": "juan.perez@example.com",
  "password": "password123",
  "telefono": "5551234567",
  "roles": ["VENDEDOR"]
}

### Actualizar usuario
PUT {{baseUrl}}/api/v1/usuarios/{{usuarioId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "nombre": "Juan Carlos",
  "apellido": "Pérez García",
  "telefono": "5559876543"
}

### Desactivar usuario
DELETE {{baseUrl}}/api/v1/usuarios/{{usuarioId}}
Authorization: Bearer {{accessToken}}

# ==========================================
# PROYECTOS
# ==========================================

### Listar todos los proyectos
GET {{baseUrl}}/api/v1/proyectos
Authorization: Bearer {{accessToken}}

### Listar proyectos activos (en venta)
GET {{baseUrl}}/api/v1/proyectos?activos=true
Authorization: Bearer {{accessToken}}

### Listar proyectos con terrenos disponibles
GET {{baseUrl}}/api/v1/proyectos?disponibles=true
Authorization: Bearer {{accessToken}}

### Listar proyectos por estado
GET {{baseUrl}}/api/v1/proyectos?estado=EN_VENTA
Authorization: Bearer {{accessToken}}

### Obtener proyecto por ID
GET {{baseUrl}}/api/v1/proyectos/1
Authorization: Bearer {{accessToken}}

### Crear proyecto
# @name createProyecto
POST {{baseUrl}}/api/v1/proyectos
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "nombre": "Residencial Los Pinos",
  "descripcion": "Desarrollo residencial de lujo con áreas verdes, alberca, casa club y seguridad 24/7",
  "direccion": "Carretera Federal México-Cuernavaca Km 42",
  "ciudad": "Cuernavaca",
  "estado": "Morelos",
  "codigoPostal": "62000",
  "latitud": 18.9186111,
  "longitud": -99.2341667,
  "tipoPrecio": "VARIABLE",
  "precioBase": 500000.00,
  "precioMaximo": 1200000.00,
  "totalTerrenos": 50,
  "terrenosDisponibles": 50,
  "estadoProyecto": "PLANIFICACION"
}

### Actualizar proyecto
PUT {{baseUrl}}/api/v1/proyectos/1
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "nombre": "Residencial Los Pinos - Fase 1",
  "descripcion": "Primera fase del desarrollo con 50 lotes premium",
  "precioBase": 550000.00
}

### Cambiar estado del proyecto a EN_VENTA
PATCH {{baseUrl}}/api/v1/proyectos/1/estado?estado=EN_VENTA
Authorization: Bearer {{accessToken}}

### Cambiar estado del proyecto a FINALIZADO
PATCH {{baseUrl}}/api/v1/proyectos/1/estado?estado=FINALIZADO
Authorization: Bearer {{accessToken}}

### Eliminar proyecto
DELETE {{baseUrl}}/api/v1/proyectos/1
Authorization: Bearer {{accessToken}}

# ==========================================
# TERRENOS
# ==========================================

### Listar todos los terrenos
GET {{baseUrl}}/api/v1/terrenos
Authorization: Bearer {{accessToken}}

### Listar terrenos por proyecto
GET {{baseUrl}}/api/v1/terrenos?proyectoId=1
Authorization: Bearer {{accessToken}}

### Listar terrenos disponibles de un proyecto
GET {{baseUrl}}/api/v1/terrenos?proyectoId=1&disponibles=true
Authorization: Bearer {{accessToken}}

### Listar terrenos por estado
GET {{baseUrl}}/api/v1/terrenos?estado=DISPONIBLE
Authorization: Bearer {{accessToken}}

### Obtener terreno por ID
GET {{baseUrl}}/api/v1/terrenos/1
Authorization: Bearer {{accessToken}}

### Crear terreno
# @name createTerreno
POST {{baseUrl}}/api/v1/terrenos
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "proyectoId": 1,
  "numeroLote": "A-001",
  "manzana": "A",
  "area": 200.50,
  "frente": 10.5,
  "fondo": 19.5,
  "precioBase": 500000.00,
  "precioAjuste": 50000.00,
  "precioMultiplicador": 1.0,
  "caracteristicas": "Esquina, vista panorámica",
  "observaciones": "Lote premium en zona residencial"
}

### Crear múltiples terrenos (lote B)
POST {{baseUrl}}/api/v1/terrenos
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "proyectoId": 1,
  "numeroLote": "B-001",
  "manzana": "B",
  "area": 180.00,
  "frente": 9.0,
  "fondo": 20.0,
  "precioBase": 450000.00,
  "precioAjuste": 0.00,
  "precioMultiplicador": 1.0
}

### Actualizar terreno
PUT {{baseUrl}}/api/v1/terrenos/1
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "precioBase": 520000.00,
  "caracteristicas": "Esquina, vista panorámica, cerca de área verde",
  "observaciones": "Precio actualizado por plusvalía"
}

### Cambiar estado del terreno a APARTADO
PATCH {{baseUrl}}/api/v1/terrenos/1/estado?estado=APARTADO
Authorization: Bearer {{accessToken}}

### Cambiar estado del terreno a VENDIDO
PATCH {{baseUrl}}/api/v1/terrenos/1/estado?estado=VENDIDO
Authorization: Bearer {{accessToken}}

### Eliminar terreno
DELETE {{baseUrl}}/api/v1/terrenos/1
Authorization: Bearer {{accessToken}}

# ==========================================
# COTIZACIONES
# ==========================================

### Listar cotizaciones
GET {{baseUrl}}/api/v1/cotizaciones
Authorization: Bearer {{accessToken}}

### Crear cotización
# @name createCotizacion
POST {{baseUrl}}/api/v1/cotizaciones
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "terrenoId": 1,
  "clienteNombre": "María González",
  "clienteEmail": "maria.gonzalez@example.com",
  "clienteTelefono": "5551234567",
  "precioBase": 550000.00,
  "descuento": 10000.00,
  "precioFinal": 540000.00,
  "fechaVigencia": "2025-12-31",
  "observaciones": "Cliente interesado en pago de contado"
}

# ==========================================
# APARTADOS
# ==========================================

### Listar apartados
GET {{baseUrl}}/api/v1/apartados
Authorization: Bearer {{accessToken}}

### Crear apartado
# @name createApartado
POST {{baseUrl}}/api/v1/apartados
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "terrenoId": 1,
  "clienteNombre": "Carlos Ramírez",
  "clienteEmail": "carlos.ramirez@example.com",
  "clienteTelefono": "5559876543",
  "clienteDireccion": "Calle 5 #123, Colonia Centro",
  "montoApartado": 50000.00,
  "precioTotal": 550000.00,
  "duracionDias": 30,
  "observaciones": "Cliente solicita 30 días para tramitar crédito"
}

### Cancelar apartado
PUT {{baseUrl}}/api/v1/apartados/1/cancelar
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "motivo": "Cliente decidió no continuar con la compra"
}

# ==========================================
# VENTAS
# ==========================================

### Listar ventas
GET {{baseUrl}}/api/v1/ventas
Authorization: Bearer {{accessToken}}

### Crear venta
# @name createVenta
POST {{baseUrl}}/api/v1/ventas
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "terrenoId": 1,
  "apartadoId": 1,
  "compradorNombre": "Carlos Ramírez",
  "compradorEmail": "carlos.ramirez@example.com",
  "compradorTelefono": "5559876543",
  "compradorDireccion": "Calle 5 #123, Colonia Centro",
  "compradorRfc": "RAMC850615ABC",
  "compradorCurp": "RAMC850615HDFLRR02",
  "precioTotal": 550000.00,
  "montoApartadoAcreditado": 50000.00,
  "montoFinal": 500000.00,
  "porcentajeComision": 3.0,
  "montoComision": 15000.00,
  "formaPago": "CREDITO_BANCARIO",
  "observaciones": "Venta realizada con crédito hipotecario"
}

### Actualizar estado de venta
PUT {{baseUrl}}/api/v1/ventas/1/estado
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "estado": "PAGADO",
  "observaciones": "Pago completado el 13/11/2025"
}

# ==========================================
# REPORTES
# ==========================================

### Reporte de Ventas
GET {{baseUrl}}/api/v1/reportes/ventas?fechaInicio=2025-01-01&fechaFin=2025-12-31
Authorization: Bearer {{accessToken}}

### Reporte de Disponibilidad
GET {{baseUrl}}/api/v1/reportes/disponibilidad?proyectoId=1
Authorization: Bearer {{accessToken}}

### Reporte de Comisiones
GET {{baseUrl}}/api/v1/reportes/comisiones?vendedorId={{usuarioId}}&mes=11&anio=2025
Authorization: Bearer {{accessToken}}

# ==========================================
# SWAGGER UI
# ==========================================

### Abrir Swagger UI
# @name swagger
GET {{baseUrl}}/swagger-ui.html

### OpenAPI JSON
GET {{baseUrl}}/api-docs
